{
    "sourceFile": "src/main/java/chihalu/totalitems/command/TotalItemsCommand.java",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1760867549779,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1760868024732,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -40,10 +40,10 @@\n                                 .suggests((context, builder) -> suggestItemIds(context, builder))\r\n                                 .executes(ctx -> executeEnable(ctx, StringArgumentType.getString(ctx, \"itemId\")))\r\n                         )\r\n                         .then(\r\n-                            CommandManager.literal(\"lefthand\")\r\n-                                .executes(ctx -> executeEnableLefthand(ctx))\r\n+                            CommandManager.literal(\"offhand\")\r\n+                                .executes(ctx -> executeEnableOffhand(ctx))\r\n                         )\r\n                 )\r\n                 .then(\r\n                     CommandManager.literal(\"disable\")\r\n@@ -52,10 +52,10 @@\n                                 .suggests((context, builder) -> suggestTrackedItems(context, builder))\r\n                                 .executes(ctx -> executeDisable(ctx, StringArgumentType.getString(ctx, \"itemId\")))\r\n                         )\r\n                         .then(\r\n-                            CommandManager.literal(\"lefthand\")\r\n-                                .executes(ctx -> executeDisableLefthand(ctx))\r\n+                            CommandManager.literal(\"offhand\")\r\n+                                .executes(ctx -> executeDisableOffhand(ctx))\r\n                         )\r\n                 )\r\n         );\r\n     }\r\n@@ -124,11 +124,11 @@\n         return 1;\r\n     }\r\n     \r\n     /**\r\n-     * 左手に持っているアイテムを追跡対象に追加\r\n+     * オフハンド（左手）に持っているアイテムを追跡対象に追加\r\n      */\r\n-    private static int executeEnableLefthand(CommandContext<ServerCommandSource> ctx) {\r\n+    private static int executeEnableOffhand(CommandContext<ServerCommandSource> ctx) {\r\n         net.minecraft.server.network.ServerPlayerEntity player = ctx.getSource().getPlayer();\r\n         if (player == null) {\r\n             ctx.getSource().sendError(Text.literal(\"§c[Total Items] このコマンドはプレイヤーのみが実行できます\"));\r\n             return 0;\r\n@@ -159,11 +159,11 @@\n         return 1;\r\n     }\r\n     \r\n     /**\r\n-     * 左手に持っているアイテムを追跡対象から削除\r\n+     * オフハンド（左手）に持っているアイテムを追跡対象から削除\r\n      */\r\n-    private static int executeDisableLefthand(CommandContext<ServerCommandSource> ctx) {\r\n+    private static int executeDisableOffhand(CommandContext<ServerCommandSource> ctx) {\r\n         net.minecraft.server.network.ServerPlayerEntity player = ctx.getSource().getPlayer();\r\n         if (player == null) {\r\n             ctx.getSource().sendError(Text.literal(\"§c[Total Items] このコマンドはプレイヤーのみが実行できます\"));\r\n             return 0;\r\n"
                }
            ],
            "date": 1760867549779,
            "name": "Commit-0",
            "content": "package chihalu.totalitems.command;\r\n\r\nimport com.mojang.brigadier.CommandDispatcher;\r\nimport com.mojang.brigadier.arguments.StringArgumentType;\r\nimport com.mojang.brigadier.context.CommandContext;\r\nimport com.mojang.brigadier.suggestion.SuggestionsBuilder;\r\nimport com.mojang.brigadier.suggestion.Suggestions;\r\nimport net.fabricmc.fabric.api.command.v2.CommandRegistrationCallback;\r\nimport net.minecraft.server.command.CommandManager;\r\nimport net.minecraft.server.command.ServerCommandSource;\r\nimport net.minecraft.text.Text;\r\nimport net.minecraft.registry.Registries;\r\nimport chihalu.totalitems.config.TotalItemsServerConfig;\r\nimport java.util.ArrayList;\r\nimport java.util.concurrent.CompletableFuture;\r\n\r\npublic class TotalItemsCommand {\r\n    \r\n    public static void register() {\r\n        CommandRegistrationCallback.EVENT.register((dispatcher, registryAccess, environment) -> {\r\n            registerTotalItemsCommand(dispatcher);\r\n        });\r\n    }\r\n    \r\n    private static void registerTotalItemsCommand(CommandDispatcher<ServerCommandSource> dispatcher) {\r\n        dispatcher.register(\r\n            CommandManager.literal(\"totalitems\")\r\n                .then(\r\n                    CommandManager.literal(\"on\")\r\n                        .executes(ctx -> executeOn(ctx))\r\n                )\r\n                .then(\r\n                    CommandManager.literal(\"off\")\r\n                        .executes(ctx -> executeOff(ctx))\r\n                )\r\n                .then(\r\n                    CommandManager.literal(\"enable\")\r\n                        .then(\r\n                            CommandManager.argument(\"itemId\", StringArgumentType.string())\r\n                                .suggests((context, builder) -> suggestItemIds(context, builder))\r\n                                .executes(ctx -> executeEnable(ctx, StringArgumentType.getString(ctx, \"itemId\")))\r\n                        )\r\n                        .then(\r\n                            CommandManager.literal(\"lefthand\")\r\n                                .executes(ctx -> executeEnableLefthand(ctx))\r\n                        )\r\n                )\r\n                .then(\r\n                    CommandManager.literal(\"disable\")\r\n                        .then(\r\n                            CommandManager.argument(\"itemId\", StringArgumentType.string())\r\n                                .suggests((context, builder) -> suggestTrackedItems(context, builder))\r\n                                .executes(ctx -> executeDisable(ctx, StringArgumentType.getString(ctx, \"itemId\")))\r\n                        )\r\n                        .then(\r\n                            CommandManager.literal(\"lefthand\")\r\n                                .executes(ctx -> executeDisableLefthand(ctx))\r\n                        )\r\n                )\r\n        );\r\n    }\r\n    \r\n    private static int executeOn(CommandContext<ServerCommandSource> ctx) {\r\n        TotalItemsServerConfig.setEnabled(true);\r\n        ctx.getSource().sendFeedback(\r\n            () -> Text.literal(\"§a[Total Items] Mod が有効になりました\"),\r\n            false\r\n        );\r\n        return 1;\r\n    }\r\n    \r\n    private static int executeOff(CommandContext<ServerCommandSource> ctx) {\r\n        TotalItemsServerConfig.setEnabled(false);\r\n        ctx.getSource().sendFeedback(\r\n            () -> Text.literal(\"§c[Total Items] Mod が無効になりました\"),\r\n            false\r\n        );\r\n        return 1;\r\n    }\r\n    \r\n    private static int executeEnable(CommandContext<ServerCommandSource> ctx, String itemIdParam) {\r\n        final String itemId = itemIdParam.trim();\r\n        \r\n        if (!itemId.matches(\"[a-z0-9_:-]+\")) {\r\n            ctx.getSource().sendError(\r\n                Text.literal(\"§c[Total Items] 無効なアイテムIDです: \" + itemId)\r\n            );\r\n            return 0;\r\n        }\r\n        \r\n        java.util.List<String> trackedItems = new ArrayList<>(TotalItemsServerConfig.getTrackedItems());\r\n        if (!trackedItems.contains(itemId)) {\r\n            trackedItems.add(itemId);\r\n            TotalItemsServerConfig.setTrackedItems(trackedItems);\r\n            ctx.getSource().sendFeedback(\r\n                () -> Text.literal(\"§a[Total Items] \" + itemId + \" を追跡対象に追加しました\"),\r\n                false\r\n            );\r\n        } else {\r\n            ctx.getSource().sendFeedback(\r\n                () -> Text.literal(\"§e[Total Items] \" + itemId + \" は既に追跡対象です\"),\r\n                false\r\n            );\r\n        }\r\n        return 1;\r\n    }\r\n    \r\n    private static int executeDisable(CommandContext<ServerCommandSource> ctx, String itemIdParam) {\r\n        final String itemId = itemIdParam.trim();\r\n        \r\n        java.util.List<String> trackedItems = new ArrayList<>(TotalItemsServerConfig.getTrackedItems());\r\n        if (trackedItems.remove(itemId)) {\r\n            TotalItemsServerConfig.setTrackedItems(trackedItems);\r\n            ctx.getSource().sendFeedback(\r\n                () -> Text.literal(\"§a[Total Items] \" + itemId + \" を追跡対象から削除しました\"),\r\n                false\r\n            );\r\n        } else {\r\n            ctx.getSource().sendFeedback(\r\n                () -> Text.literal(\"§e[Total Items] \" + itemId + \" は追跡対象に含まれていません\"),\r\n                false\r\n            );\r\n        }\r\n        return 1;\r\n    }\r\n    \r\n    /**\r\n     * 左手に持っているアイテムを追跡対象に追加\r\n     */\r\n    private static int executeEnableLefthand(CommandContext<ServerCommandSource> ctx) {\r\n        net.minecraft.server.network.ServerPlayerEntity player = ctx.getSource().getPlayer();\r\n        if (player == null) {\r\n            ctx.getSource().sendError(Text.literal(\"§c[Total Items] このコマンドはプレイヤーのみが実行できます\"));\r\n            return 0;\r\n        }\r\n        \r\n        net.minecraft.item.ItemStack leftHandStack = player.getOffHandStack();\r\n        if (leftHandStack.isEmpty()) {\r\n            ctx.getSource().sendError(Text.literal(\"§c[Total Items] 左手に何も持っていません\"));\r\n            return 0;\r\n        }\r\n        \r\n        String itemId = net.minecraft.registry.Registries.ITEM.getId(leftHandStack.getItem()).toString();\r\n        \r\n        java.util.List<String> trackedItems = new ArrayList<>(TotalItemsServerConfig.getTrackedItems());\r\n        if (!trackedItems.contains(itemId)) {\r\n            trackedItems.add(itemId);\r\n            TotalItemsServerConfig.setTrackedItems(trackedItems);\r\n            ctx.getSource().sendFeedback(\r\n                () -> Text.literal(\"§a[Total Items] \" + itemId + \" を追跡対象に追加しました\"),\r\n                false\r\n            );\r\n        } else {\r\n            ctx.getSource().sendFeedback(\r\n                () -> Text.literal(\"§e[Total Items] \" + itemId + \" は既に追跡対象です\"),\r\n                false\r\n            );\r\n        }\r\n        return 1;\r\n    }\r\n    \r\n    /**\r\n     * 左手に持っているアイテムを追跡対象から削除\r\n     */\r\n    private static int executeDisableLefthand(CommandContext<ServerCommandSource> ctx) {\r\n        net.minecraft.server.network.ServerPlayerEntity player = ctx.getSource().getPlayer();\r\n        if (player == null) {\r\n            ctx.getSource().sendError(Text.literal(\"§c[Total Items] このコマンドはプレイヤーのみが実行できます\"));\r\n            return 0;\r\n        }\r\n        \r\n        net.minecraft.item.ItemStack leftHandStack = player.getOffHandStack();\r\n        if (leftHandStack.isEmpty()) {\r\n            ctx.getSource().sendError(Text.literal(\"§c[Total Items] 左手に何も持っていません\"));\r\n            return 0;\r\n        }\r\n        \r\n        String itemId = net.minecraft.registry.Registries.ITEM.getId(leftHandStack.getItem()).toString();\r\n        \r\n        java.util.List<String> trackedItems = new ArrayList<>(TotalItemsServerConfig.getTrackedItems());\r\n        if (trackedItems.remove(itemId)) {\r\n            TotalItemsServerConfig.setTrackedItems(trackedItems);\r\n            ctx.getSource().sendFeedback(\r\n                () -> Text.literal(\"§a[Total Items] \" + itemId + \" を追跡対象から削除しました\"),\r\n                false\r\n            );\r\n        } else {\r\n            ctx.getSource().sendFeedback(\r\n                () -> Text.literal(\"§e[Total Items] \" + itemId + \" は追跡対象に含まれていません\"),\r\n                false\r\n            );\r\n        }\r\n        return 1;\r\n    }\r\n    \r\n    /**\r\n     * 全アイテムIDの補完を提供\r\n     */\r\n    private static CompletableFuture<Suggestions> suggestItemIds(\r\n            CommandContext<ServerCommandSource> context, SuggestionsBuilder builder) {\r\n        String input = builder.getRemaining().toLowerCase();\r\n        \r\n        Registries.ITEM.getIds().forEach(id -> {\r\n            String itemId = id.toString();\r\n            if (itemId.toLowerCase().contains(input)) {\r\n                // コロンを含むアイテムIDは引用符で囲む必要がある\r\n                builder.suggest(\"\\\"\" + itemId + \"\\\"\");\r\n            }\r\n        });\r\n        \r\n        return builder.buildFuture();\r\n    }\r\n    \r\n    /**\r\n     * 現在追跡中のアイテムIDの補完を提供\r\n     */\r\n    private static CompletableFuture<Suggestions> suggestTrackedItems(\r\n            CommandContext<ServerCommandSource> context, SuggestionsBuilder builder) {\r\n        String input = builder.getRemaining().toLowerCase();\r\n        \r\n        TotalItemsServerConfig.getTrackedItems().forEach(itemId -> {\r\n            if (itemId.toLowerCase().contains(input)) {\r\n                // コロンを含むアイテムIDは引用符で囲む必要がある\r\n                builder.suggest(\"\\\"\" + itemId + \"\\\"\");\r\n            }\r\n        });\r\n        \r\n        return builder.buildFuture();\r\n    }\r\n}\r\n"
        }
    ]
}